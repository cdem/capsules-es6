<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Capsule ES6+ #3 : code asynchrone en JavaScript</title>
</head>
<body>
  <h2>
    Capsule ES6+ #3 : code asynchrone en JavaScript
  </h2>
  <h3><code><i>callback</i></code> | <code><b>Promise</b></code> | <code><u>async/await</u></code></h3>
  <h4>Les exemples dans ce fichier sont expliqués dans cette <a href="https://web.microsoftstream.com/video/5bc31088-2f78-4246-bcd5-b5bc351a10e5" title="Capsule ES6+ #2" target="_blank">capsule vidéo</a>.</h4>
  <h3>Références</h3>
  <dl>
    
  </dl>

  <hr>
  <p>
    (<i>Consulter le code source et la console de votre navigateur.</i>)
  </p>
  <hr>

  <script>
    // Nous allons faire un appel asynchrone à une API externe (consultez fakestoreapi.com pour plus de détail)
    const adresseApi = 'https://fakestoreapi.com/products?limit=3';

    /**************************************************************/
    // Méthode 1 : utilisation d'un callback (ou fonction de rappel)
    function testAsyncAvecXHR() {
      let xhr = new XMLHttpRequest();
      xhr.open('get', adresseApi);
      xhr.responseType = "json";
      xhr.onload = gererLaReponse;
      xhr.send();

      function gererLaReponse() {
        console.log("Méthode 1 | Callback | Objet JSON retourné par la requête : ", xhr.response);
      }
    }
     testAsyncAvecCallback();

    /************************************************************************/
    // Méthode 2 : utilisation des 'promesses' (ou objet 'Promise' en anglais)
    function testAsyncAvecPromise() {
      fetch(adresseApi).then(
        reponse => reponse.json()
      ).then(
        reponseJson => console.log("Méthode 2 | Promise | Objet JSON retourné par la requête : ", reponseJson)
      ).catch(
        erreur => console.log(erreur)
      );
    }
    // testAsyncAvecPromise();

    /**************************************************/
    // Méthode 3 : utilisation de la syntaxe async/await
    async function testAsyncAvecAsyncAwait() {
      const reponse = await fetch(adresseApi);
      const reponseJson = await reponse.json();
      console.log("Méthode 3 | async/await | Objet JSON retourné par la requête : ", reponseJson);
    }
    //testAsyncAvecAsyncAwait();

  </script>
</body>
</html>